<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - {{ title | default('Panel') }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.0.6/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/global.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>

  <style>
    #toast-container {
      position: fixed !important;
      top: 1rem !important;
      right: 1rem !important;
      z-index: 9999 !important;
      pointer-events: none !important;
    }
    .toast {
      background-color: rgba(0, 0, 0, 0.85) !important;
      color: #fff !important;
      padding: 0.6rem 1rem !important;
      margin-bottom: 0.5rem !important;
      border-radius: 4px !important;
      font-size: 0.9rem !important;
      max-width: 250px !important;
      word-wrap: break-word !important;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      pointer-events: auto !important;
    }
    .toast.show {
      opacity: 1 !important;
      transform: translateY(0) !important;
    }

      /* SUCCESS: zielone tło */
.toast.success {
  background-color: #28a745 !important;  /* Bootstrap green */
  border-left: 4px solid #1e7e34 !important;
}

/* ERROR: czerwone tło */
.toast.error {
  background-color: #dc3545 !important;  /* Bootstrap red */
  border-left: 4px solid #b21f2d !important;
}
  </style>
</head>
<body>
    <!-- Kontener na toast-owe komunikaty -->
  <div id="toast-container"></div>
    <div class="app-layout">
        {# Lewy Panel Boczny (Sidebar) #}
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="project-name"><i class="ri-briefcase-line"></i> Bizzio </h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/dashboard" class="sidebar-link active"><i class="ri-dashboard-line"></i> Dashboard</a></li>
                    <li><a href="/calendar" class="sidebar-link"><i class="ri-calendar-line"></i> Kalendarz</a></li>
                    <li class="nav-item has-submenu">
                        <a href="#" class="sidebar-link submenu-toggle"><i class="ri-service-line"></i> Usługi <i class="ri-arrow-down-s-line arrow-icon"></i></a>
                        <ul class="submenu">
                            <li><a href="/services" class="sidebar-link"><i class="ri-list-check"></i> Rejestr usług</a></li>
                            <li><a href="/services/add-type" class="sidebar-link"><i class="ri-add-box-line"></i> Typy usług</a></li>
                            <li><a href="/services/add-category" class="sidebar-link"><i class="ri-file-add-line"></i> Kategorie usług</a></li>
                        </ul>
                    </li>
                    <li class="nav-item has-submenu">
                        <a href="#" class="sidebar-link submenu-toggle"><i class="ri-wallet-line"></i> Koszty <i class="ri-arrow-down-s-line arrow-icon"></i></a>
                        <ul class="submenu">
                            <li><a href="/costs/" class="sidebar-link"><i class="ri-money-dollar-box-line"></i> Rejestr kosztów</a></li>
                            <li><a href="/costs/contractors" class="sidebar-link"><i class="ri-user-2-line"></i> Kontrahenci</a></li>
                            <li><a href="/costs/add-category" class="sidebar-link"><i class="ri-file-add-line"></i> Kategorie kosztów </a></li>
                        </ul>
                    </li>
                    <li><a href="/clients" class="sidebar-link"><i class="ri-group-line"></i> Klienci</a></li>
                    <li><a href="/reports" class="sidebar-link"><i class="ri-pie-chart-line"></i> Raporty</a></li>
                    <li><a href="/settings" class="sidebar-link"><i class="ri-settings-line"></i> Ustawienia</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                {# Można dodać np. info o wersji, logo firmy #}
            </div>
        </aside>

        {# Główna zawartość #}
        <main class="main-content">
            {# Górny pasek (Top Bar) - można go przenieść do oddzielnego bloku w przyszłości #}
            <header class="top-bar">
    <div class="top-bar-left">
        <h1 class="page-title">{{ title | default('Dashboard') }}</h1>
    </div>
    <div class="page-header-right">
        {% if request.session.user %}
        <span>Witaj, {{ request.session.user.given_name }}</span>
        <a href="/logout" role="button" class="secondary" style="margin-left: 1rem;">Wyloguj</a>
        {% endif %}
    </div>
</header>

            <div class="content-area">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>

{# Include Flatpickr JS - jeśli już jest w base.html, możesz to usunąć stąd #}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pl.js"></script>

<script src="/static/js/global.js" defer></script>
{% block scripts %}
     {% if not request.session.user %}
            // Sprawdzamy, czy nie jesteśmy już w trakcie logowania, aby uniknąć pętli
            if (window.location.pathname !== '/login' && window.location.pathname !== '/auth') {
                // Jeśli użytkownik nie jest zalogowany, natychmiast przekieruj
                window.location.href = '/login';
            }
        {% endif %}
    {% endblock %}
</body>
</html>